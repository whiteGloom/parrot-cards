import{d as E,r,C as I,T as M,u as R,j as e,b as F,e as A,a as D}from"./index-CmfdTOkq.js";import{c as k,B as i,a as l,P as q}from"./createLucideIcon-D2QS0q9a.js";import{D as _,S as $,a as z,R as B,A as G,C as L}from"./remove-tag-from-cards-B4pcINW7.js";import{T as P}from"./selectable-tag-C5MIf-SM.js";import{I as O,T,X as U}from"./input-wrapped-CEIm1ICa.js";import{l as V}from"./loadGoogleDriveFolderId-Dugd9Kg8.js";import{a as N}from"./savedFile-oeRihVRP.js";import"./color-CpnjabFv.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M9 13a4.5 4.5 0 0 0 3-4",key:"10igwf"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M16 8V5a2 2 0 0 1 2-2",key:"u6izg6"}],["circle",{cx:"16",cy:"13",r:".5",key:"ry7gng"}],["circle",{cx:"18",cy:"3",r:".5",key:"1aiba7"}],["circle",{cx:"20",cy:"21",r:".5",key:"yhc1fs"}],["circle",{cx:"20",cy:"8",r:".5",key:"1e43v0"}]],W=k("brain-circuit",H);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],X=k("brain",J);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],K=k("download",Z);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Y=k("plus",Q);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],se=k("upload",ee);function te(){const w=E(),x=r.useContext(I),S=r.useContext(M),b=R(),[d,y]=r.useState(!1),[C,g]=r.useState(null),[c,p]=r.useState("test.json");return e.jsx(_,{buildContent:()=>e.jsxs(e.Fragment,{children:[e.jsx(O,{name:"export:filename",label:"File name",autofocus:!0,value:c,onChange:n=>{p(n.target.value)}}),e.jsx(i,{isLoading:d,hint:C||"Export to Google",theme:C?l.warning:l.primary,onClick:async()=>{if(g(null),!w.oauthSettings?.clientId){b({to:"/google-auth-settings"}).catch(null);return}y(!0);try{let n=function(f){return m+`Content-Type: application/json\r
\r
`+JSON.stringify(f)+m+"Content-Type: "+j+`\r
Content-Transfer-Encoding: base64\r
\r
`+v+t};w.authorizationData.state!=="authorized"&&await w.authorize();const s=await V(),h=await N({cardsStore:x,tagsStore:S}),v=btoa(h),j="application/json",u="-------314159265358979323846",m=`\r
--${u}\r
`,t=`\r
--${u}--`,o=(await gapi.client.drive.files.list({q:`trashed = false and '${s}' in parents and name = '${c}'`,fields:"files(id, name, mimeType, parents)",pageSize:1})).result.files?.[0];let a;o?a=await gapi.client.request({path:`/upload/drive/v3/files/${o.id}`,method:"PATCH",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/related; boundary="'+u+'"'},body:n({name:c})}):a=await gapi.client.request({path:"/upload/drive/v3/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/related; boundary="'+u+'"'},body:n({name:c,mimeType:j,parents:[s]})}),console.log("wgl response",a),y(!1)}catch(n){g(`${n}`),y(!1)}},children:"Google Drive"}),e.jsx(i,{onClick:async()=>{const n=new Blob([await N({cardsStore:x,tagsStore:S})],{type:"application/json"}),s=document.createElement("A");s.href=URL.createObjectURL(n),s.download=c,s.target="_blank",s.click(),URL.revokeObjectURL(s.download)},children:"Local file"})]}),buildButton:n=>e.jsx(i,{onClick:n.toggleOpened,hint:"Export cards",theme:l.primary,children:e.jsxs(e.Fragment,{children:[e.jsx(se,{}),e.jsx("span",{className:"ml-1 hidden md:flex",children:"Export"})]})}),contentWrapperClassName:"right-0 border bg-white rounded shadow-xl/30 border-gray-200 p-2 gap-2"})}const pe=function(){const x=R(),S=r.useContext(I),b=r.useContext(M),d=F(),y=A(),C=D(),[g,c]=r.useState(new Set),[p,n]=r.useState(new Set),[s,h]=r.useState(new Set),[v,j]=r.useState(!1),u=r.useRef(s);u.current!==s&&(v&&j(!1),u.current=s);const m=r.useMemo(()=>p.size?d.cardsIds.filter(t=>d.cards[t].tags.some(a=>p.has(a))):d.cardsIds,[p,d.cardsIds,d.cards]);return r.useEffect(()=>{S?.subscribe((t,o)=>{t.cardsIds!==o.cardsIds&&h(new Set(Array.from(s).filter(a=>t.cardsIds.includes(a))))}),b?.subscribe((t,o)=>{t.tagsIds!==o.tagsIds&&n(new Set(Array.from(p).filter(a=>t.tagsIds.includes(a))))})},[S,s,p,b]),e.jsx(q,{children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col bg-gray-50 p-4 gap-4 justify-center border border-gray-200 rounded",children:[e.jsx("h1",{className:"text-2xl text-purple-800",children:"Parrot Cards"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{hint:"Create new cards",onClick:()=>{x({to:"/create-new-cards"}).catch(null)},children:[e.jsx(Y,{}),e.jsx("span",{className:"ml-1 hidden md:flex",children:"Create new cards"})]}),e.jsx("div",{className:"grow"}),e.jsx(i,{onClick:()=>{x({to:"/import"}).catch(null)},hint:"Import cards",theme:l.secondary,children:e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsx("span",{className:"ml-1 hidden md:flex",children:"Import"})]})}),e.jsx(te,{})]})]}),e.jsxs("div",{className:"flex flex-col bg-gray-50 p-4 gap-4 justify-center border border-gray-200 rounded",children:[e.jsx("h2",{className:"text-xl text-purple-800",children:"Loaded tags:"}),e.jsxs("div",{className:"flex flex-col gap-2 overflow-y-auto max-h-60",children:[y.tagsIds.map(t=>e.jsx(P,{tagId:t,isSelected:g.has(t),onSelectedChange:o=>{if(o)c(new Set([...g,t]));else{const a=[];for(const f of g)f!==t&&a.push(f);c(new Set(a))}}},t)),!y.tagsIds.length&&e.jsx("p",{className:"text-gray-600",children:"No tags loaded"})]}),e.jsx(i,{onClick:()=>{h(new Set),n(new Set(g))},children:"Apply filter"})]}),e.jsxs("div",{className:"flex flex-col bg-gray-50 p-4 gap-4 justify-center border border-gray-200 rounded",children:[e.jsx("h2",{className:"text-xl text-purple-800",children:"Result:"}),!v&&!!m.length&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{hint:"Select all cards",onClick:()=>{s.size==m.length?h(new Set):h(new Set(d.cardsIds))},theme:l.secondary,children:s.size==m.length?e.jsx($,{}):e.jsx(z,{})}),e.jsx(i,{theme:l.primary,onClick:()=>{x({to:"/revise",search:{tags:Array.from(p)}}).catch(null)},hint:"Revise found cards",children:e.jsxs(e.Fragment,{children:[e.jsx(X,{}),e.jsx("span",{className:"ml-1 hidden md:flex",children:"Revise"})]})}),!!s.size&&e.jsxs(e.Fragment,{children:[e.jsx(i,{theme:l.primary,onClick:()=>{const t=Array.from(s),a=C.findExistingRevise(t)||C.addRevise(t);x({to:"/revise",search:{explicitReviseId:a}}).catch(null)},hint:"Revise selected (selection is not stored between sessions)",children:e.jsxs(e.Fragment,{children:[e.jsx(W,{}),e.jsx("span",{className:"ml-1 hidden md:flex",children:"Revise selected"})]})}),e.jsx(i,{onClick:()=>{j(!0)},theme:l.warning,children:e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsx("span",{className:"ml-1 hidden md:flex",children:"Delete"})]})}),e.jsx(B,{cardsIds:s}),e.jsx(G,{cardsIds:s})]})]}),v&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{theme:l.primary,onClick:()=>{j(!1)},children:e.jsx(U,{})}),e.jsx(i,{theme:l.warning,onClick:()=>{d.removeCards(Array.from(s))},children:e.jsx(T,{})}),e.jsx("p",{children:"Delete selected cards?"})]}),m.map(t=>e.jsx(L,{cardId:t,isSelected:s.has(t),onSelectedChange:o=>{if(o)h(new Set([...s,t]));else{const a=[];for(const f of s)f!==t&&a.push(f);h(new Set(a))}}},t)),!m.length&&e.jsx("p",{className:"text-gray-600",children:"No cards loaded"})]})]})})};export{pe as component};
