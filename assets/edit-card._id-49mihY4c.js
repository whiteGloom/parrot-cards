import{u as T,r as d,T as C,e as y,b as R,f as v,j as t}from"./index-Be9N7zuG.js";import{P as q,B as h,a as j}from"./createLucideIcon-Ch4xOR8G.js";import{F as I}from"./formik.esm-D15yhvCe.js";import{i as S}from"./inline-for-D-FZR1qe.js";import{I as u,a as k}from"./input-wrapped-D1KnbYWs.js";import{T as P}from"./selectable-tag-wwqoXr8_.js";import{A}from"./arrow-left-D2v-tIfP.js";import"./color-CpnjabFv.js";const V=function(){const N=T(),x=d.useContext(C),l=y(),f=R(),w=v.useParams().id,s=f.cards[w],[o,c]=d.useState(new Set(s.tags)),[m,L]=d.useState(""),[g,b]=d.useState([s.targetLanguageSide.hints.length+1,s.knownLanguageSide.hints.length+1]);return d.useEffect(()=>{x?.subscribe((e,a)=>{e.tagsIds!==a.tagsIds&&c(new Set(Array.from(o).filter(r=>e.tagsIds.includes(r))))})},[o,x]),t.jsxs(q,{children:[t.jsxs("div",{className:"flex bg-white p-2 gap-3 border items-center border-gray-200 rounded",children:[t.jsx(h,{className:"self-start",theme:j.secondary,onClick:()=>{N({to:"/"}).catch(null)},children:t.jsx(A,{})}),t.jsx("h1",{className:"text-2xl text-purple-800",children:"Create new cards"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[3fr_2fr] gap-3",children:[t.jsx(I,{onSubmit:e=>{f.updateCard(w,{targetLanguageSide:{title:e.targetLanguage.title,description:e.targetLanguage.description,hints:e.targetLanguage.hints.reduce((a,r)=>{const i=r.trim();return i&&a.push(i),a},[])},knownLanguageSide:{title:e.knownLanguage.title,description:e.knownLanguage.description,hints:e.knownLanguage.hints.reduce((a,r)=>{const i=r.trim();return i&&a.push(i),a},[])},tags:Array.from(o)})},validate:e=>{const a={};return e.targetLanguage.title.trim()||(a.targetLanguage={title:"Required"}),e.knownLanguage.title.trim()||(a.knownLanguage={title:"Required"}),a},validateOnChange:!0,initialValues:{targetLanguage:{title:s.targetLanguageSide.title,description:s.targetLanguageSide.description,hints:s.knownLanguageSide.hints},knownLanguage:{title:s.knownLanguageSide.title,description:s.knownLanguageSide.description,hints:s.knownLanguageSide.hints}},children:({values:e,handleChange:a,errors:r,handleSubmit:i})=>t.jsxs("form",{onSubmit:i,className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex flex-col bg-white p-3 gap-3 justify-center border border-gray-200 rounded",children:[t.jsx("h2",{className:"text-xl text-purple-800",children:"Target language side"}),t.jsx(u,{label:"Title",isRequired:!0,name:"targetLanguage.title",value:e.targetLanguage.title,onChange:a,error:r.targetLanguage?.title,autofocus:!0}),t.jsx(k,{label:"Description",isRequired:!0,id:"targetLanguage.description",children:t.jsx("textarea",{id:"targetLanguage.description",name:"targetLanguage.description",value:e.targetLanguage.description,className:"border p-1 rounded border-gray-400 shadow bg-white",rows:4,onChange:a})}),S(g[0],n=>t.jsx(u,{label:`Hint ${n+1}`,isRequired:!0,name:`targetLanguage.hints[${n}]`,value:e.targetLanguage.hints[n],onChange:p=>{g[0]<n+2&&b([g[0]+1,g[1]]),a(p)}},n))]}),t.jsxs("div",{className:"flex flex-col bg-white p-3 gap-3 justify-center border border-gray-200 rounded",children:[t.jsx("h2",{className:"text-xl text-purple-800",children:"Known language side"}),t.jsx(u,{label:"Title",isRequired:!0,name:"knownLanguage.title",value:e.knownLanguage.title,onChange:a,error:r.knownLanguage?.title}),t.jsx(k,{label:"Description",isRequired:!0,id:"knownLanguage.description",children:t.jsx("textarea",{id:"knownLanguage.description",name:"knownLanguage.description",value:e.knownLanguage.description,className:"border p-1 rounded border-gray-400 shadow bg-white",rows:4,onChange:a})}),S(g[1],n=>t.jsx(u,{label:`Hint ${n+1}`,isRequired:!0,name:`knownLanguage.hints[${n}]`,value:e.knownLanguage.hints[n],onChange:p=>{g[1]<n+2&&b([g[0],g[1]+1]),a(p)}},n))]}),t.jsx(h,{type:"submit",children:"Update the card"})]})}),t.jsx("div",{className:"bg-white border border-gray-200 rounded relative",children:t.jsxs("div",{className:"md:absolute top-0 left-0 md:w-full md:h-full md:overflow-y-auto flex flex-col p-3 gap-3",children:[t.jsx("h2",{className:"text-xl text-purple-800",children:"Tags"}),t.jsxs("div",{className:"flex flex-col gap-2",children:[l.tagsIds.map(e=>t.jsx(P,{tagId:e,isSelected:o.has(e),onSelectedChange:a=>{const r=new Set(o);a?r.add(e):r.delete(e),c(r)}},e)),!l.tagsIds.length&&t.jsx("p",{className:"text-gray-600",children:"No tags loaded"})]}),t.jsx(u,{label:"New tag",name:"newTagTitle",isRequired:!0,value:m,onChange:e=>{L(e.target.value)}}),t.jsx(h,{theme:j.primary,disabled:!m.trim(),onClick:()=>{const e=m.trim();if(!e)return;L("");let a;const r=l.tagsIds.find(i=>l.tags[i].title===e);r?a=r:a=l.createTag({title:e}).id,c(new Set([...o,a]))},children:"Create new card"})]})})]})]})};export{V as component};
