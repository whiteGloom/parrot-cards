import{u as T,r as d,T as C,e as y,b as R,h as v,j as t}from"./index-ChGQAPBh.js";import{P as q,B as h,a as j}from"./page-content-wrapper-Ft0DP455.js";import{F as I}from"./formik.esm-OaONLrPg.js";import{i as S,T as P}from"./selectable-tag-B5mafT8b.js";import{I as u,a as k}from"./input-wrapped-CQF0Q0bq.js";import{A}from"./arrow-left-BJ2Vvhx9.js";import"./schemas-DBNbPpsj.js";const O=function(){const N=T(),x=d.useContext(C),l=y(),f=R(),w=v.useParams().id,s=f.cards[w],[o,c]=d.useState(new Set(s.tags)),[m,L]=d.useState(""),[g,b]=d.useState([s.targetLanguageSide.hints.length+1,s.knownLanguageSide.hints.length+1]);return d.useEffect(()=>{x?.subscribe((e,a)=>{e.tagsIds!==a.tagsIds&&c(new Set(Array.from(o).filter(n=>e.tagsIds.includes(n))))})},[o,x]),t.jsxs(q,{children:[t.jsxs("div",{className:"flex bg-white p-2 gap-3 border items-center border-gray-200 rounded",children:[t.jsx(h,{className:"self-start",theme:j.secondary,onClick:()=>{N({to:"/"}).catch(null)},children:t.jsx(A,{})}),t.jsx("h1",{className:"text-2xl text-purple-800",children:"Update card"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[3fr_2fr] gap-3",children:[t.jsx(I,{onSubmit:e=>{f.updateCard(w,{targetLanguageSide:{title:e.targetLanguage.title,description:e.targetLanguage.description,hints:e.targetLanguage.hints.reduce((a,n)=>{const i=n.trim();return i&&a.push(i),a},[])},knownLanguageSide:{title:e.knownLanguage.title,description:e.knownLanguage.description,hints:e.knownLanguage.hints.reduce((a,n)=>{const i=n.trim();return i&&a.push(i),a},[])},tags:Array.from(o)})},validate:e=>{const a={};return e.targetLanguage.title.trim()||(a.targetLanguage={title:"Required"}),e.knownLanguage.title.trim()||(a.knownLanguage={title:"Required"}),a},validateOnChange:!0,initialValues:{targetLanguage:{title:s.targetLanguageSide.title,description:s.targetLanguageSide.description,hints:s.knownLanguageSide.hints},knownLanguage:{title:s.knownLanguageSide.title,description:s.knownLanguageSide.description,hints:s.knownLanguageSide.hints}},children:({values:e,handleChange:a,errors:n,handleSubmit:i})=>t.jsxs("form",{onSubmit:i,className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"flex flex-col bg-white p-3 gap-3 justify-center border border-gray-200 rounded",children:[t.jsx("h2",{className:"text-xl text-purple-800",children:"Target language side"}),t.jsx(u,{label:"Title",isRequired:!0,name:"targetLanguage.title",value:e.targetLanguage.title,onChange:a,error:n.targetLanguage?.title,autofocus:!0}),t.jsx(k,{label:"Description",isRequired:!0,id:"targetLanguage.description",children:t.jsx("textarea",{id:"targetLanguage.description",name:"targetLanguage.description",value:e.targetLanguage.description,className:"border p-1 rounded border-gray-400 shadow bg-white",rows:4,onChange:a})}),S(g[0],r=>t.jsx(u,{label:`Hint ${r+1}`,isRequired:!0,name:`targetLanguage.hints[${r}]`,value:e.targetLanguage.hints[r],onChange:p=>{g[0]<r+2&&b([g[0]+1,g[1]]),a(p)}},r))]}),t.jsxs("div",{className:"flex flex-col bg-white p-3 gap-3 justify-center border border-gray-200 rounded",children:[t.jsx("h2",{className:"text-xl text-purple-800",children:"Known language side"}),t.jsx(u,{label:"Title",isRequired:!0,name:"knownLanguage.title",value:e.knownLanguage.title,onChange:a,error:n.knownLanguage?.title}),t.jsx(k,{label:"Description",isRequired:!0,id:"knownLanguage.description",children:t.jsx("textarea",{id:"knownLanguage.description",name:"knownLanguage.description",value:e.knownLanguage.description,className:"border p-1 rounded border-gray-400 shadow bg-white",rows:4,onChange:a})}),S(g[1],r=>t.jsx(u,{label:`Hint ${r+1}`,isRequired:!0,name:`knownLanguage.hints[${r}]`,value:e.knownLanguage.hints[r],onChange:p=>{g[1]<r+2&&b([g[0],g[1]+1]),a(p)}},r))]}),t.jsx(h,{type:"submit",children:"Update the card"})]})}),t.jsx("div",{className:"bg-white border border-gray-200 rounded relative",children:t.jsxs("div",{className:"max-h-120 md:max-h-full md:absolute top-0 left-0 md:w-full md:h-full flex flex-col p-3 gap-3",children:[t.jsx("h2",{className:"text-xl text-purple-800",children:"Tags"}),t.jsxs("div",{className:"flex flex-col gap-2 overflow-y-auto grow",children:[l.tagsIds.map(e=>t.jsx(P,{tagId:e,isSelected:o.has(e),onSelectedChange:a=>{const n=new Set(o);a?n.add(e):n.delete(e),c(n)}},e)),!l.tagsIds.length&&t.jsx("p",{className:"text-gray-600",children:"No tags loaded"})]}),t.jsx(u,{label:"New tag",name:"newTagTitle",isRequired:!0,value:m,onChange:e=>{L(e.target.value)}}),t.jsx(h,{theme:j.primary,disabled:!m.trim(),onClick:()=>{const e=m.trim();if(!e)return;L("");let a;const n=l.tagsIds.find(i=>l.tags[i].title===e);n?a=n:a=l.createTag({title:e}).id,c(new Set([...o,a]))},children:"Create new tag"})]})})]})]})};export{O as component};
