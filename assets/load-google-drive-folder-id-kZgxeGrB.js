import{r as i,C as w,T as x,c as k,d as T,j as h}from"./index-CfiYgMeU.js";import{o,a as c,s as r,b as E,H as F,l as L}from"./color-CpnjabFv.js";import{c as b,B as z,a as C}from"./page-content-wrapper-Dy17aZap.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],j=b("repeat",O),p=o({title:r(),description:r(),hints:c(r())}),D=o({id:r(),knownLanguageSide:p,targetLanguageSide:p});o({knownLanguageSide:p,targetLanguageSide:p,tags:c(r())});const _=o({id:r(),title:r()});o({title:r(),color:E(F)});const B=o({version:L(1),content:o({cards:c(D),tags:c(_)})});function N(e){const t=JSON.parse(e);if(t.version!==1)throw new Error("Unsupported file version");return B.parse(t),t}async function R(e){const{cardsStore:t,tagsStore:n,fileContent:a}=e,s=N(a);t.getState().addCards(s.content.cards),n.getState().addTags(s.content.tags)}async function Z(e){const{cardsStore:t,tagsStore:n}=e,a={version:1,content:{cards:t.getState().cardsIds.map(s=>t.getState().cards[s]),tags:n.getState().tagsIds.map(s=>n.getState().tags[s])}};return JSON.stringify(a)}function $(e){const t=i.useContext(w),n=i.useContext(x),a=k(),s=T(),[u,y]=i.useState(!1),[m,d]=i.useState(!1),[S,g]=i.useState(null);async function v(){if(m||u)return;e.onClick?.(),d(!0),g(null);let l;try{await s.authorize();for(const f in a.fileToLoadRecords){const I=a.fileToLoadRecords[f];if(l=await gapi.client.drive.files.get({fileId:I.fileId,alt:"media"}),l.status!==200){g(`Error fetching file, status: ${l.status}`),d(!1);return}await R({cardsStore:t,tagsStore:n,fileContent:l.body})}y(!0)}catch(f){d(!1),g(`Error fetching file ${f}`);return}d(!1)}return h.jsx(z,{className:"self-start",theme:S?C.warning:C.primary,hint:S||`One-click import (${a.itemsCount} files)`,isLoading:m,disabled:u||!a.itemsCount,onClick:v,children:h.jsx(j,{size:e.iconSize||24})})}async function q(){const e=await gapi.client.drive.files.list({q:"mimeType = 'application/vnd.google-apps.folder' and trashed = false and 'root' in parents and name = 'Parrot Cards'",fields:"files(id, name, mimeType, parents)",pageSize:1});return e.result.files?.length?e.result.files[0].id:(await gapi.client.drive.files.create({resource:{name:"Parrot Cards",mimeType:"application/vnd.google-apps.folder"},fields:"id, name, mimeType, parents"})).result.id}export{$ as O,Z as a,q as l,R as p};
