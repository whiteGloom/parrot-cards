import{j as e,u as y,b as S,c as v,r as o,C as w,T as F}from"./index-Be9N7zuG.js";import{c as L,b,P as k,B as g,a as j}from"./createLucideIcon-Ch4xOR8G.js";import{p as T}from"./savedFile-DJW18iJF.js";import{O as E}from"./one-click-import-C_xcPhH0.js";import{l as D}from"./loadGoogleDriveFolderId-Dugd9Kg8.js";import{A as R}from"./arrow-left-D2v-tIfP.js";import"./color-CpnjabFv.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],G=L("rotate-cw",B),M="_loader_1fi3d_2",P={loader:M};function _(m){return e.jsx("div",{className:b([P.loader,m.colorClassName||"after:bg-blue-500",m.className])})}function z(m){const[c,u]=o.useState(!1),[l,r]=o.useState(!1),[p,n]=o.useState(null),h=o.useContext(w),f=o.useContext(F),d=v(),{file:t}=m,x=!!d.fileToLoadRecords[t.id];return e.jsx(g,{isLoading:l,disabled:c,theme:j.secondary,onClick:async()=>{if(l||c)return;r(!0),n(null);let s;try{if(s=await gapi.client.drive.files.get({fileId:t.id,alt:"media"}),s.status!==200){n(`Error fetching file, status: ${s.status}`),r(!1);return}await T({cardsStore:h,tagsStore:f,fileContent:s.body}),u(!0)}catch(i){r(!1),n(`Error fetching file ${i}`);return}r(!1)},contentBuilder:s=>e.jsxs("div",{className:"flex grow flex-col items-start",children:[e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx("p",{title:t.id,className:"font-medium grow text-start",style:{color:s.textColor},children:t.name}),e.jsx("input",{title:"Mark the file to add it to one-click import list",type:"checkbox",checked:x,onClick:i=>{i.stopPropagation()},onChange:i=>{i.stopPropagation(),x?d.removeFileToLoad(t.id):d.addFileToLoad({fileId:t.id,fileName:t.name})}})]}),p&&e.jsx("p",{className:"text-red-500",children:p}),c&&e.jsx("p",{className:"text-green-500",children:"Imported!"}),l&&e.jsx(_,{})]})},t.id)}const K=function(){const c=y(),u=S(),l=v(),[r,p]=o.useState(!0),[n,h]=o.useState([]),[f,d]=o.useState([]),t=async()=>{p(!0);const s=await D(),I=((await gapi.client.drive.files.list({q:`trashed = false and '${s}' in parents`,pageSize:50})).result.files||[]).map(a=>({name:a.name,id:a.id,mimeType:a.mimeType,parents:a.parents})),C=I.map(a=>a.id),N=[];for(const a in l.fileToLoadRecords)C.includes(a)||N.push(l.fileToLoadRecords[a]);h(I),d(N),p(!1)},x=o.useRef(t).current;return o.useEffect(()=>{x().catch(null)},[x]),e.jsxs(k,{contentWrapperClassName:"bg-gray-50 p-4 rounded",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(g,{className:"self-start",theme:j.secondary,onClick:()=>{c({to:"/import"}).catch(null)},children:e.jsx(R,{})}),e.jsx("h1",{className:"text-2xl text-purple-800",children:"Import from Google Drive"})]}),e.jsxs("div",{className:"flex row gap-2",children:[e.jsx(g,{isLoading:r,onClick:t,children:e.jsx(G,{size:16})}),e.jsx("p",{className:"grow text-center text-gray-800",children:"Existing files with data:"}),e.jsx(E,{iconSize:16})]}),r&&e.jsx("div",{className:"border border-gray-200 bg-white rounded p-2 flex flex-col gap-3",children:e.jsx("p",{children:"Loading files..."})}),!r&&n.length===0&&e.jsx("div",{className:"border border-gray-200 bg-white rounded p-2 flex flex-col gap-3",children:e.jsx("p",{className:"text-gray-600",children:'No files found in "Parrot Cards" folder'})}),!r&&n.length>0&&e.jsx("div",{className:"flex flex-col gap-2 max-h-64 overflow-y-auto",children:n.map(s=>e.jsx(z,{file:s},s.id))}),!!f.length&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-red-800",children:"Some of one-click import files are missing!"}),e.jsx("div",{className:"flex flex-col gap-2 max-h-64 overflow-y-auto",children:f.map(s=>e.jsxs(g,{theme:j.warning,hint:"Remove from one-click import list",onClick:()=>{d(f.filter(i=>i.fileId!==s.fileId)),l.removeFileToLoad(s.fileId)},children:[s.fileName," ","(ID:",s.fileId,")"]},s.fileId))})]}),e.jsx("hr",{className:"border-gray-200"}),e.jsxs("p",{className:"text-gray-800",children:["Loaded:"," ",u.cardsIds.length," ","cards"]}),e.jsx(g,{onClick:()=>{c({to:"/"}).catch(null)},children:"Go home"})]})};export{K as component};
