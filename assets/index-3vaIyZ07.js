import{d as L,f as _,r as n,C as I,T as M,u as R,j as e,c as q,b as z,e as B,a as G}from"./index-CfiYgMeU.js";import{c as k,B as o,a as c,b as $,P}from"./page-content-wrapper-Dy17aZap.js";import{D as A,S as U,a as V,R as W,A as H,C as J}from"./remove-tag-from-cards-HJirptnY.js";import{T as X}from"./selectable-tag-DtYvgKsW.js";import{I as O,T as E,X as Z}from"./input-wrapped-Dj8BqKAb.js";import{l as K,a as D,O as Q,p as Y}from"./load-google-drive-folder-id-kZgxeGrB.js";import"./color-CpnjabFv.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M9 13a4.5 4.5 0 0 0 3-4",key:"10igwf"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M16 8V5a2 2 0 0 1 2-2",key:"u6izg6"}],["circle",{cx:"16",cy:"13",r:".5",key:"ry7gng"}],["circle",{cx:"18",cy:"3",r:".5",key:"1aiba7"}],["circle",{cx:"20",cy:"21",r:".5",key:"yhc1fs"}],["circle",{cx:"20",cy:"8",r:".5",key:"1e43v0"}]],te=k("brain-circuit",ee);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],ae=k("brain",se);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],ne=k("download",re);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],F=k("plus",oe);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],le=k("settings",ie);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ce=k("upload",de);function he(){const f=L(),x=_(),C=n.useContext(I),S=n.useContext(M),p=R(),[y,g]=n.useState(!1),[m,v]=n.useState(null),[l,b]=n.useState("test.json");return e.jsx(A,{buildContent:()=>e.jsxs(e.Fragment,{children:[e.jsx(O,{name:"export:filename",label:"File name",autofocus:!0,value:l,onChange:s=>{b(s.target.value)}}),e.jsx(o,{isLoading:y,hint:m||"Export to Google",theme:m?c.warning:c.primary,onClick:async()=>{if(v(null),!f.oauthSettings?.clientId){p({to:"/google-auth-settings"}).catch(null);return}g(!0);try{let s=function(i){return T+`Content-Type: application/json\r
\r
`+JSON.stringify(i)+T+"Content-Type: "+h+`\r
Content-Transfer-Encoding: base64\r
\r
`+u+w};f.authorizationData.state!=="authorized"&&await f.authorize();const a=await K(),r=await D({cardsStore:C,tagsStore:S}),u=btoa(r),h="application/json",j="-------314159265358979323846",T=`\r
--${j}\r
`,w=`\r
--${j}--`,t=(await gapi.client.drive.files.list({q:`trashed = false and '${a}' in parents and name = '${l}'`,fields:"files(id, name, mimeType, parents)",pageSize:1})).result.files?.[0];t?await gapi.client.request({path:`/upload/drive/v3/files/${t.id}`,method:"PATCH",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/related; boundary="'+j+'"'},body:s({name:l})}):await gapi.client.request({path:"/upload/drive/v3/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/related; boundary="'+j+'"'},body:s({name:l,mimeType:h,parents:[a]})}),g(!1),x.markAsSaved()}catch(s){v(`${s}`),g(!1)}},children:"Google Drive"}),e.jsx(o,{onClick:async()=>{const s=new Blob([await D({cardsStore:C,tagsStore:S})],{type:"application/json"}),a=document.createElement("A");a.href=URL.createObjectURL(s),a.download=l,a.target="_blank",a.click(),URL.revokeObjectURL(a.download),x.markAsSaved()},children:"Local file"})]}),buildButton:s=>e.jsx(o,{onClick:s.toggleOpened,hint:"Export cards",theme:c.primary,children:e.jsxs(e.Fragment,{children:[e.jsx(ce,{}),e.jsx("span",{className:"ml-1 hidden md:flex",children:"Export"})]})}),contentWrapperClassName:"right-0 border bg-white rounded shadow-xl/30 border-gray-200 p-2 gap-2"})}function pe(){const f=R(),x=L(),C=q(),S=n.useContext(I),p=n.useContext(M),[y,g]=n.useState(!1),m=!!x.oauthSettings?.clientId,v=m&&!!C.itemsCount,[l,b]=n.useState();return e.jsx(A,{buildButton:s=>e.jsx(o,{onClick:s.toggleOpened,hint:"Import cards",theme:c.secondary,children:e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsx("span",{className:"ml-1 hidden md:flex",children:"Import"})]})}),contentWrapperClassName:"right-[-3rem] min-w-xxs",buildContent:({close:s})=>e.jsxs("div",{className:"flex flex-col gap-2 p-2 shadow-xl/30 bg-white rounded border border-gray-200 max-h-60 overflow-y-auto",children:[e.jsxs("div",{className:"flex row gap-2",children:[e.jsx(o,{theme:c.primary,className:"grow",onClick:async()=>{g(!0);try{if(!m){f({to:"/google-auth-settings"}).catch(null);return}await x.authorize(),f({to:"/import-from-google-drive"}).catch(null)}catch(a){console.error("Error during authorization:",a)}finally{g(!1)}},isLoading:y,children:"Google Drive"}),v&&e.jsx(Q,{}),e.jsx(o,{className:"self-start",theme:c.secondary,hint:"Open settings for Google OAuth",onClick:()=>{f({to:"/google-auth-settings"}).catch(null),s()},children:e.jsx(le,{})})]}),e.jsx("hr",{className:"border-gray-200 mt-2 mb-2"}),e.jsx("input",{type:"file",className:$(["p-2 rounded border bg-white border-gray-200","file:border file:shadow file:bg-white file:px-2 file:py-1 file:rounded file:border-solid file:border-gray-200","file:hover:bg-[#f2f2f2] file:active:bg-[#E7E7E7] file:disabled:text-gray-500 file:disabled:bg-gray-200"]),onChange:a=>{b(a.target.files?.[0])}}),e.jsx(o,{disabled:!l,isLoading:y,onClick:async()=>{g(!0);try{const a=await new Promise((r,u)=>{const h=new FileReader;h.onload=function(){r(h.result)},h.onerror=u,h.onabort=u,h.readAsText(l)});await Y({cardsStore:S,tagsStore:p,fileContent:a})}catch(a){console.error(a)}finally{g(!1)}},children:"Local File"})]})})}const Ce=function(){const x=R(),C=n.useContext(I),S=n.useContext(M),p=z(),y=B(),g=G(),[m,v]=n.useState(""),[l,b]=n.useState(new Set),[s,a]=n.useState(new Set),[r,u]=n.useState(new Set),[h,j]=n.useState(!1),T=n.useRef(r);T.current!==r&&(h&&j(!1),T.current=r);const w=n.useMemo(()=>s.size?p.cardsIds.filter(t=>p.cards[t].tags.some(d=>s.has(d))):p.cardsIds,[s,p.cardsIds,p.cards]);return n.useEffect(()=>{C?.subscribe((t,i)=>{t.cardsIds!==i.cardsIds&&u(new Set(Array.from(r).filter(d=>t.cardsIds.includes(d))))}),S?.subscribe((t,i)=>{t.tagsIds!==i.tagsIds&&a(new Set(Array.from(s).filter(d=>t.tagsIds.includes(d))))})},[C,r,s,S]),e.jsx(P,{children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col bg-gray-50 p-4 gap-4 justify-center border border-gray-200 rounded",children:[e.jsx("h1",{className:"text-2xl text-purple-800",children:"Parrot Cards"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{hint:"Create new cards",onClick:()=>{x({to:"/create-new-cards"}).catch(null)},children:[e.jsx(F,{}),e.jsx("span",{className:"ml-1 hidden md:flex",children:"Create new cards"})]}),e.jsx("div",{className:"grow"}),e.jsx(pe,{}),e.jsx(he,{})]})]}),e.jsxs("div",{className:"flex flex-col bg-gray-50 p-4 gap-4 justify-center border border-gray-200 rounded",children:[e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("h2",{className:"text-xl text-purple-800",children:"Loaded tags:"}),e.jsx(A,{contentWrapperClassName:"right-0",buildContent:t=>e.jsxs("div",{className:"flex flex-col gap-2 p-2 shadow-xl/30 bg-white rounded border border-gray-200 max-h-60 overflow-y-auto",children:[e.jsx(O,{label:"New tag",name:"newTagTitle",isRequired:!0,value:m,autofocus:!0,onChange:i=>{v(i.target.value)}}),e.jsx(o,{theme:c.primary,disabled:!m.trim(),onClick:()=>{const i=m.trim();i&&(v(""),y.maybeCreateTag({title:i}),t.close())},children:"Create new tag"})]}),buildButton:t=>e.jsx(o,{onClick:t.toggleOpened,children:e.jsx(F,{})})})]}),e.jsxs("div",{className:"flex flex-col gap-2 overflow-y-auto max-h-60",children:[y.tagsIds.map(t=>e.jsx(X,{tagId:t,isSelected:l.has(t),onSelectedChange:i=>{if(i)b(new Set([...l,t]));else{const d=[];for(const N of l)N!==t&&d.push(N);b(new Set(d))}}},t)),!y.tagsIds.length&&e.jsx("p",{className:"text-gray-600",children:"No tags loaded"})]}),e.jsx(o,{onClick:()=>{u(new Set),a(new Set(l))},children:"Apply filter"})]}),e.jsxs("div",{className:"flex flex-col bg-gray-50 p-4 gap-4 justify-center border border-gray-200 rounded",children:[e.jsx("h2",{className:"text-xl text-purple-800",children:"Result:"}),!h&&!!w.length&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{hint:"Select all cards",onClick:()=>{r.size==w.length?u(new Set):u(new Set(p.cardsIds))},theme:c.secondary,children:r.size==w.length?e.jsx(U,{}):e.jsx(V,{})}),e.jsx(o,{theme:c.primary,onClick:()=>{x({to:"/revise",search:{tags:Array.from(s)}}).catch(null)},hint:"Revise found cards",children:e.jsxs(e.Fragment,{children:[e.jsx(ae,{}),e.jsx("span",{className:"ml-1 hidden md:flex",children:"Revise"})]})}),!!r.size&&e.jsxs(e.Fragment,{children:[e.jsx(o,{theme:c.primary,onClick:()=>{const t=Array.from(r),d=g.findExistingRevise(t)||g.addRevise(t);x({to:"/revise",search:{explicitReviseId:d}}).catch(null)},hint:"Revise selected (selection is not stored between sessions)",children:e.jsxs(e.Fragment,{children:[e.jsx(te,{}),e.jsx("span",{className:"ml-1 hidden md:flex",children:"Revise selected"})]})}),e.jsx(o,{onClick:()=>{j(!0)},theme:c.warning,children:e.jsxs(e.Fragment,{children:[e.jsx(E,{}),e.jsx("span",{className:"ml-1 hidden md:flex",children:"Delete"})]})}),e.jsx(W,{cardsIds:r}),e.jsx(H,{cardsIds:r})]})]}),h&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{theme:c.primary,onClick:()=>{j(!1)},children:e.jsx(Z,{})}),e.jsx(o,{theme:c.warning,onClick:()=>{p.removeCards(Array.from(r))},children:e.jsx(E,{})}),e.jsx("p",{children:"Delete selected cards?"})]}),w.map(t=>e.jsx(J,{cardId:t,isSelected:r.has(t),onSelectedChange:i=>{if(i)u(new Set([...r,t]));else{const d=[];for(const N of r)N!==t&&d.push(N);u(new Set(d))}}},t)),!w.length&&e.jsx("p",{className:"text-gray-600",children:"No cards loaded"})]})]})})};export{Ce as component};
