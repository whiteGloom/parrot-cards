import{j as e,u as w,b as y,c as N,r as a,C as S,T as k,d as F}from"./index-COZU6M3M.js";import{c as L,b,P as T,B as g,a as v}from"./page-content-wrapper-DdlR8LYN.js";import{O as D,l as E,p as z}from"./load-google-drive-folder-id-BAmffcng.js";import{A as R}from"./arrow-left-D8m6flPY.js";import"./schemas-DBNbPpsj.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],G=L("rotate-cw",B),M="_loader_1fi3d_2",P={loader:M};function _(f){return e.jsx("div",{className:b([P.loader,f.colorClassName||"after:bg-blue-500",f.className])})}function $(f){const[c,h]=a.useState(!1),[n,r]=a.useState(!1),[p,l]=a.useState(null),j=a.useContext(S),x=a.useContext(k),d=N(),u=F(),{file:s}=f,t=!!d.fileToLoadRecords[s.id];return e.jsx(g,{isLoading:n,disabled:c,theme:v.secondary,onClick:async()=>{if(!(n||c)){r(!0),l(null);try{const o=await fetch(`https://www.googleapis.com/drive/v3/files/${s.id}?alt=media`,{headers:{Authorization:`Bearer ${u.authorizationData.state==="authorized"&&u.authorizationData.tokenInfo.accessToken}`}});if(o.status!==200){l(`Error fetching file, status: ${o.status}`),r(!1);return}await z({cardsStore:j,tagsStore:x,fileContent:await o.text()}),h(!0)}catch(o){r(!1),l(`Error fetching file ${o}`);return}r(!1)}},contentBuilder:o=>e.jsxs("div",{className:"flex grow flex-col items-start",children:[e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx("p",{title:s.id,className:"font-medium grow text-start",style:{color:o.textColor},children:s.name}),e.jsx("input",{title:"Mark the file to add it to one-click import list",type:"checkbox",checked:t,onClick:m=>{m.stopPropagation()},onChange:m=>{m.stopPropagation(),t?d.removeFileToLoad(s.id):d.addFileToLoad({fileId:s.id,fileName:s.name})}})]}),p&&e.jsx("p",{className:"text-red-500",children:p}),c&&e.jsx("p",{className:"text-green-500",children:"Imported!"}),n&&e.jsx(_,{})]})},s.id)}const J=function(){const c=w(),h=y(),n=N(),[r,p]=a.useState(!0),[l,j]=a.useState([]),[x,d]=a.useState([]),u=async()=>{p(!0);const t=await E(),m=((await gapi.client.drive.files.list({q:`trashed = false and '${t}' in parents`,pageSize:50})).result.files||[]).map(i=>({name:i.name,id:i.id,mimeType:i.mimeType,parents:i.parents})),C=m.map(i=>i.id),I=[];for(const i in n.fileToLoadRecords)C.includes(i)||I.push(n.fileToLoadRecords[i]);j(m),d(I),p(!1)},s=a.useRef(u).current;return a.useEffect(()=>{s().catch(null)},[s]),e.jsx(T,{children:e.jsxs("div",{className:"flex flex-col gap-4 bg-gray-50 p-4 rounded",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(g,{className:"self-start",theme:v.secondary,onClick:()=>{c({to:"/"}).catch(null)},children:e.jsx(R,{})}),e.jsx("h1",{className:"text-2xl text-purple-800",children:"Import from Google Drive"})]}),e.jsxs("div",{className:"flex row gap-2",children:[e.jsx(g,{isLoading:r,onClick:u,children:e.jsx(G,{size:16})}),e.jsx("p",{className:"grow text-center text-gray-800",children:"Existing files with data:"}),e.jsx(D,{iconSize:16})]}),r&&e.jsx("div",{className:"border border-gray-200 bg-white rounded p-2 flex flex-col gap-3",children:e.jsx("p",{children:"Loading files..."})}),!r&&l.length===0&&e.jsx("div",{className:"border border-gray-200 bg-white rounded p-2 flex flex-col gap-3",children:e.jsx("p",{className:"text-gray-600",children:'No files found in "Parrot Cards" folder'})}),!r&&l.length>0&&e.jsx("div",{className:"flex flex-col gap-2 max-h-64 overflow-y-auto",children:l.map(t=>e.jsx($,{file:t},t.id))}),!!x.length&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-red-800",children:"Some of one-click import files are missing!"}),e.jsx("div",{className:"flex flex-col gap-2 max-h-64 overflow-y-auto",children:x.map(t=>e.jsxs(g,{theme:v.warning,hint:"Remove from one-click import list",onClick:()=>{d(x.filter(o=>o.fileId!==t.fileId)),n.removeFileToLoad(t.fileId)},children:[t.fileName," ","(ID:",t.fileId,")"]},t.fileId))})]}),e.jsx("hr",{className:"border-gray-200"}),e.jsxs("p",{className:"text-gray-800",children:["Loaded:"," ",h.cardsIds.length," ","cards"]}),e.jsx(g,{onClick:()=>{c({to:"/"}).catch(null)},children:"Go home"})]})})};export{J as component};
