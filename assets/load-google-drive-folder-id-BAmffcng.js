import{r as c,C as y,T as I,c as x,d as L,j as k}from"./index-COZU6M3M.js";import{o as g,a as p,l as z,s as r,n as d,t as T}from"./schemas-DBNbPpsj.js";import{c as E,B as F,a as v}from"./page-content-wrapper-DdlR8LYN.js";/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],O=E("repeat",D),A=g({title:r(),description:r().optional(),hints:p(r()).optional()}),b=g({id:r(),knownLanguageSide:A,targetLanguageSide:A,tags:p(r()).optional(),createdAt:d(),updatedAt:d()}),j=T([d(),d(),d(),d().optional().nullable()]),B=g({id:r(),title:r(),color:j}),_=g({version:z(1),content:g({cards:p(b),tags:p(B)})});function $(a){const n=JSON.parse(a);if(n.version!==1)throw new Error("Unsupported file version");return _.parse(n),n}async function N(a){const{cardsStore:n,tagsStore:s,fileContent:i}=a,o=$(i),t=[];for(const e of o.content.cards)t.push({id:e.id,tags:e.tags||[],targetLanguageSide:{title:e.targetLanguageSide.title,description:e.targetLanguageSide.description||"",hints:e.targetLanguageSide.hints||[]},knownLanguageSide:{title:e.knownLanguageSide.title,description:e.knownLanguageSide.description||"",hints:e.knownLanguageSide.hints||[]},createdAt:e.createdAt,updatedAt:e.updatedAt});const l=[];for(const e of o.content.tags)l.push({id:e.id,title:e.title,createdAt:e.createdAt,updatedAt:e.updatedAt,color:{angle:e.color[0],saturation:e.color[1],lightness:e.color[2],alpha:e.color[3]||100}});n.getState().addCards(t),s.getState().addTags(l)}async function Z(a){const{cardsStore:n,tagsStore:s}=a,i={version:1,content:{cards:n.getState().cardsIds.map(o=>{const t=n.getState().cards[o];return{id:t.id,updatedAt:t.updatedAt,createdAt:t.createdAt,tags:t.tags.length?t.tags:void 0,targetLanguageSide:{title:t.targetLanguageSide.title,description:t.targetLanguageSide.description.length?t.targetLanguageSide.description:void 0,hints:t.targetLanguageSide.hints.length?t.targetLanguageSide.hints:void 0},knownLanguageSide:{title:t.knownLanguageSide.title,description:t.knownLanguageSide.description.length?t.knownLanguageSide.description:void 0,hints:t.knownLanguageSide.hints.length?t.knownLanguageSide.hints:void 0}}}),tags:s.getState().tagsIds.map(o=>{const t=s.getState().tags[o];return{id:t.id,title:t.title,updatedAt:t.updatedAt,createdAt:t.createdAt,color:[t.color.angle,t.color.saturation,t.color.lightness,t.color.alpha||100]}})}};return JSON.stringify(i)}function q(a){const n=c.useContext(y),s=c.useContext(I),i=x(),o=L(),t=L(),[l,e]=c.useState(!1),[m,u]=c.useState(!1),[w,S]=c.useState(null);async function C(){if(!(m||l)){a.onClick?.(),u(!0),S(null);try{await o.authorize();for(const f in i.fileToLoadRecords){const h=await fetch(`https://www.googleapis.com/drive/v3/files/${f}?alt=media`,{headers:{Authorization:`Bearer ${t.authorizationData.state==="authorized"&&t.authorizationData.tokenInfo.accessToken}`}});if(h.status!==200){S(`Error fetching file, status: ${h.status}`),u(!1);return}await N({cardsStore:n,tagsStore:s,fileContent:await h.text()})}e(!0)}catch(f){u(!1),S(`Error fetching file ${f}`);return}u(!1)}}return k.jsx(F,{className:"self-start",theme:w?v.warning:v.primary,hint:w||`One-click import (${i.itemsCount} files)`,isLoading:m,disabled:l||!i.itemsCount,onClick:C,children:k.jsx(O,{size:a.iconSize||24})})}async function H(){const a=await gapi.client.drive.files.list({q:"mimeType = 'application/vnd.google-apps.folder' and trashed = false and 'root' in parents and name = 'Parrot Cards'",fields:"files(id, name, mimeType, parents)",pageSize:1});return a.result.files?.length?a.result.files[0].id:(await gapi.client.drive.files.create({resource:{name:"Parrot Cards",mimeType:"application/vnd.google-apps.folder"},fields:"id, name, mimeType, parents"})).result.id}export{q as O,Z as a,H as l,N as p};
